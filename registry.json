{
  "name": "registry",

  "imports": [
    { "uri": "http://www.apidoc.me/flow/common/0.0.9/service.json" }
  ],

  "enums": {
    "application_type": {
      "values": [
        { "name": "api" },
        { "name": "database", "description": "Any type of storage interface" },
        { "name": "ui", "description": "Any user interface" }
      ]
    }
  },
  
  "models": {

    "application": {
      "fields": [
        { "name": "id", "type": "string" },
        { "name": "type", "type": "application_type" },
        { "name": "ports", "type": "[port]", "description": "All of the ports assigned to this application" }
      ]
    },

    "application_reference": {
      "fields": [
        { "name": "id", "type": "string" }
      ]
    },

    "application_form": {
      "fields": [
        { "name": "id", "type": "string" },
        { "name": "type", "type": "application_type" }
      ]
    },

    "application_put_form": {
      "fields": [
        { "name": "type", "type": "application_type" }
      ]
    },

    "port": {
      "fields": [
        { "name": "id", "type": "string" },
        { "name": "application", "type": "application_reference" },
        { "name": "number", "type": "long" }
      ]
    },
    
    "port_form": {
      "fields": [
        { "name": "application_id", "type": "string" },
        { "name": "number", "type": "long" }
      ]
    }
    
  },

  "resources": {
    "io.flow.common.v0.models.healthcheck": {
      "path": "/_internal_",
      "operations": [
        {
          "method": "GET",
          "path": "/healthcheck",
          "responses": {
            "200": { "type": "io.flow.common.v0.models.healthcheck" }
          }
        }
      ]
    },

    "application": {
      "operations": [
        {
          "method": "GET",
          "description": "Search applications. Always paginated.",
          "parameters": [
            { "name": "id", "type": "[string]", "required": false, "maximum": 100 },
            { "name": "limit", "type": "long", "default": 25, "minimum": 1, "maximum": 100 },
            { "name": "offset", "type": "long", "default": 0, "minimum": 0 },
            { "name": "sort", "type": "string", "default": "-created_at" }
          ],
          "responses": {
            "200": { "type": "[application]" },
            "401": { "type": "unit" }
          }
        },

        {
          "method": "GET",
          "description": "Returns information about a specific application.",
          "path": "/:id",
          "responses": {
            "200": { "type": "application" },
            "401": { "type": "unit" },
            "404": { "type": "unit" }
          }
        },

        {
          "method": "POST",
          "description": "Create a new application.",
          "body": { "type": "application_form" },
          "responses": {
            "201": { "type": "application" },
            "401": { "type": "unit" },
            "422": { "type": "[io.flow.common.v0.models.error]" }
          }
        },

        {
          "method": "PUT",
          "path": "/:id",
          "description": "Upsert an application with the specified id.",
          "body": { "type": "application_put_form" },
          "responses": {
            "200": { "type": "application" },
            "201": { "type": "application" },
            "401": { "type": "unit" },
            "422": { "type": "[io.flow.common.v0.models.error]" }
          }
        },

        {
          "method": "DELETE",
          "description": "Delete the application with this id",
          "path": "/:id",
          "responses": {
            "204": { "type": "unit" },
            "401": { "type": "unit" },
            "404": { "type": "unit" }
          }
        }
      ]          
    },

    "port": {
      "operations": [
        {
          "method": "GET",
          "description": "Search ports. Always paginated.",
          "parameters": [
            { "name": "number", "type": "[long]", "required": false, "maximum": 100 },
            { "name": "application", "type": "[string]", "required": false, "maximum": 100 },
            { "name": "limit", "type": "long", "default": 25, "minimum": 1, "maximum": 100 },
            { "name": "offset", "type": "long", "default": 0, "minimum": 0 },
            { "name": "sort", "type": "string", "default": "applications.name,number" }
          ],
          "responses": {
            "200": { "type": "[port]" },
            "401": { "type": "unit" }
          }
        },

        {
          "method": "GET",
          "description": "Returns information about a specific port.",
          "path": "/:number",
          "responses": {
            "200": { "type": "port" },
            "401": { "type": "unit" },
            "404": { "type": "unit" }
          }
        },

        {
          "method": "POST",
          "description": "Create a new port.",
          "body": { "type": "port_form" },
          "responses": {
            "201": { "type": "port" },
            "401": { "type": "unit" },
            "422": { "type": "[io.flow.common.v0.models.error]" }
          }
        },

        {
          "method": "DELETE",
          "description": "Delete this port",
          "path": "/:number",
          "responses": {
            "204": { "type": "unit" },
            "401": { "type": "unit" },
            "404": { "type": "unit" }
          }
        }
      ]          
    }

  }
}

